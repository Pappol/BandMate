{% extends "base.html" %}

{% block title %}Personalize Band - BandMate{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-neutral-50 to-neutral-100 py-8">
    <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-primary rounded-full mb-6">
                <i class="fas fa-palette text-white text-3xl"></i>
            </div>
            <h1 class="text-3xl font-bold text-neutral-800 mb-4">Personalize Your Band</h1>
            <p class="text-lg text-neutral-600">
                Make your band unique with custom emoji, color, and letter identifiers
            </p>
        </div>

        <!-- Current Band Info -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold text-neutral-800 mb-4">Current Band: {{ current_band.name }}</h2>
            
            <!-- Current Personalization Display -->
            <div class="flex items-center justify-center space-x-4 mb-6">
                <div class="text-center">
                    <div class="w-16 h-16 rounded-full flex items-center justify-center text-2xl mb-2"
                         style="background-color: {{ current_band.get_display_color() }}; color: {{ current_band.get_style_attributes().color }}">
                        {{ current_band.get_display_identifier() }}
                    </div>
                    <p class="text-sm text-neutral-600">Current Display</p>
                </div>
            </div>
        </div>

        <!-- Personalization Form -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
            <form method="POST" class="space-y-6">
                <!-- Emoji Section -->
                <div>
                    <label for="emoji" class="block text-sm font-medium text-neutral-700 mb-2">
                        Band Emoji
                    </label>
                    <div class="flex items-center space-x-4">
                        <input type="text" 
                               name="emoji" 
                               id="emoji" 
                               value="{{ current_band.emoji or '' }}"
                               placeholder="ðŸŽ¸"
                               maxlength="10"
                               class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-primary focus:border-primary text-lg">
                        <div class="text-sm text-neutral-500">
                            Optional â€¢ Max 10 characters
                        </div>
                    </div>
                    <p class="text-sm text-neutral-500 mt-2">
                        Choose an emoji that represents your band's style or genre
                    </p>
                </div>

                <!-- Color Section -->
                <div>
                    <label for="color" class="block text-sm font-medium text-neutral-700 mb-2">
                        Band Color
                    </label>
                    <div class="flex items-center space-x-4">
                        <input type="color" 
                               name="color" 
                               id="color" 
                               value="{{ current_band.color or '#FF6B6B' }}"
                               class="w-16 h-12 border border-gray-300 rounded-lg cursor-pointer">
                        <input type="text" 
                               name="color_text" 
                               id="color_text" 
                               value="{{ current_band.color or '#FF6B6B' }}"
                               placeholder="#FF6B6B"
                               pattern="^#[0-9A-Fa-f]{6}$"
                               class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-primary focus:border-primary font-mono">
                    </div>
                    <p class="text-sm text-neutral-500 mt-2">
                        Pick a color that matches your band's aesthetic
                    </p>
                </div>

                <!-- Letter Section -->
                <div>
                    <label for="letter" class="block text-sm font-medium text-neutral-700 mb-2">
                        Band Letter
                    </label>
                    <div class="flex items-center space-x-4">
                        <input type="text" 
                               name="letter" 
                               id="letter" 
                               value="{{ current_band.letter or '' }}"
                               placeholder="B"
                               maxlength="1"
                               class="w-20 h-12 border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-primary focus:border-primary text-center text-xl font-bold uppercase">
                        <div class="text-sm text-neutral-500">
                            Optional â€¢ Single character
                        </div>
                    </div>
                    <p class="text-sm text-neutral-500 mt-2">
                        Use a single letter as a quick identifier
                    </p>
                </div>

                <!-- Preview Section -->
                <div class="border-t border-gray-200 pt-6">
                    <h3 class="text-lg font-medium text-neutral-800 mb-4">Preview</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <!-- Emoji Preview -->
                        <div class="text-center">
                            <div class="w-16 h-16 rounded-full flex items-center justify-center text-2xl mb-2 mx-auto bg-gray-100">
                                <span id="emoji-preview">{{ current_band.get_display_identifier() }}</span>
                            </div>
                            <p class="text-sm text-neutral-600">Emoji</p>
                        </div>
                        
                        <!-- Color Preview -->
                        <div class="text-center">
                            <div class="w-16 h-16 rounded-full flex items-center justify-center text-2xl mb-2 mx-auto"
                                 id="color-preview"
                                 style="background-color: {{ current_band.get_display_color() }}; color: {{ current_band.get_style_attributes().color }}">
                                {{ current_band.get_display_identifier() }}
                            </div>
                            <p class="text-sm text-neutral-600">Color</p>
                        </div>
                        
                        <!-- Letter Preview -->
                        <div class="text-center">
                            <div class="w-16 h-16 rounded-full flex items-center justify-center text-2xl mb-2 mx-auto bg-primary text-white font-bold"
                                 id="letter-preview">
                                {{ current_band.letter or current_band.name[0] if current_band.name else 'B' }}
                            </div>
                            <p class="text-sm text-neutral-600">Letter</p>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 pt-6">
                    <a href="{{ url_for('main.band_management') }}" 
                       class="flex-1 sm:flex-none px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 text-center transition-colors">
                        Cancel
                    </a>
                    <button type="submit" 
                            class="flex-1 sm:flex-none px-6 py-3 bg-primary text-white font-medium rounded-lg hover:bg-primary-hover transition-colors">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>

        <!-- Help Section -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mt-8">
            <h3 class="text-lg font-medium text-neutral-800 mb-4">ðŸ’¡ Tips for Great Personalization</h3>
            <div class="space-y-3 text-sm text-neutral-600">
                <div class="flex items-start space-x-3">
                    <span class="text-primary text-lg">ðŸŽ¯</span>
                    <p><strong>Emoji:</strong> Choose something that represents your music style or band personality</p>
                </div>
                <div class="flex items-start space-x-3">
                    <span class="text-primary text-lg">ðŸŽ¨</span>
                    <p><strong>Color:</strong> Pick a color that matches your band's vibe or album artwork</p>
                </div>
                <div class="flex items-start space-x-3">
                    <span class="text-primary text-lg">ðŸ”¤</span>
                    <p><strong>Letter:</strong> Use your band's first letter or a meaningful character</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Live preview updates
document.addEventListener('DOMContentLoaded', function() {
    const emojiInput = document.getElementById('emoji');
    const colorInput = document.getElementById('color');
    const colorTextInput = document.getElementById('color_text');
    const letterInput = document.getElementById('letter');
    
    const emojiPreview = document.getElementById('emoji-preview');
    const colorPreview = document.getElementById('color-preview');
    const letterPreview = document.getElementById('letter-preview');
    
    // Sync color picker and text input
    colorInput.addEventListener('input', function() {
        colorTextInput.value = this.value;
        updateColorPreview();
    });
    
    colorTextInput.addEventListener('input', function() {
        if (this.value.match(/^#[0-9A-Fa-f]{6}$/)) {
            colorInput.value = this.value;
            updateColorPreview();
        }
    });
    
    // Update emoji preview
    emojiInput.addEventListener('input', function() {
        emojiPreview.textContent = this.value || 'ðŸŽ¸';
    });
    
    // Update letter preview
    letterInput.addEventListener('input', function() {
        letterPreview.textContent = (this.value || 'B').toUpperCase();
    });
    
    function updateColorPreview() {
        const color = colorInput.value;
        colorPreview.style.backgroundColor = color;
        // Update text color for contrast
        const r = parseInt(color.substr(1,2), 16);
        const g = parseInt(color.substr(3,2), 16);
        const b = parseInt(color.substr(5,2), 16);
        const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
        colorPreview.style.color = luminance > 0.5 ? '#000000' : '#FFFFFF';
    }
    
    // Initialize previews
    updateColorPreview();
});
</script>
{% endblock %}
